<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:TodoList.Models"
             xmlns:viewmodels="clr-namespace:TodoList.ViewModels"
             xmlns:converters="clr-namespace:TodoList.Converters"
             x:Class="TodoList.Pages.MainPage"
             x:DataType="viewmodels:MainViewModel">
    <ContentPage.Resources>
        <DataTemplate x:Key ="Task" x:DataType="models:TodoTask">
            <Border>
                <Grid ColumnDefinitions="*, auto">
                    <StackLayout Spacing="5" Grid.Column="0">
                        <Label Text="{Binding Name}" FontAttributes="Bold"/>
                        <Label Text="{Binding Description}"/>
                        <HorizontalStackLayout Spacing="15">
                            <Label Text="{Binding Tag, StringFormat='#{0}'}" FontAttributes="Italic"/>
                            <Label TextColor="{Binding Status, Converter={converters:TaskStatusConverter}}"
                                   Text="{Binding DueTime, StringFormat='{0:dd/MM/yyyy HH:mm}'}"/>
                        </HorizontalStackLayout>
                    </StackLayout>
                    <HorizontalStackLayout Spacing="0" Grid.Column="1">
                        <CheckBox  Color="{Binding Priority, Converter={converters:PriorityToColorConverter}}"
                                  CheckedChanged="OnCheckBoxCheckedChanged"/>
                        <Button Style="{StaticResource DeleteButton}" Text="x" 
                Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, 
            Path=BindingContext.DeleteTaskCommand}" CommandParameter="{Binding .}"/>
                    </HorizontalStackLayout>
                </Grid>
            </Border>
        </DataTemplate>
    </ContentPage.Resources>
    <Grid RowDefinitions="Auto, *, Auto" Padding="10">
        <HorizontalStackLayout Grid.Row="0" Spacing="10" VerticalOptions="Center"
                               HorizontalOptions="Center">
            <Label Text="Фильтр:"/>
            <Picker Style="{StaticResource FilterPicker}" ItemsSource="{Binding Tags}" 
                    SelectedItem="{Binding CurrentTagFilter, Mode=TwoWay}"/>
        </HorizontalStackLayout>
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Spacing="5">
                <Label Text="Незавершенные" Style="{StaticResource HeaderLabel}"/>
                <CollectionView ItemsSource="{Binding PendingTasks}" ItemTemplate="{StaticResource Task}">
                    <CollectionView.ItemsLayout>
                        <LinearItemsLayout Orientation="Vertical" ItemSpacing="2.5"/>
                    </CollectionView.ItemsLayout>
                </CollectionView>
                <Label Text="Просроченные" Style="{StaticResource HeaderLabel}"/>
                <CollectionView ItemsSource="{Binding OverDueTasks}" ItemTemplate="{StaticResource Task}">
                    <CollectionView.ItemsLayout>
                        <LinearItemsLayout Orientation="Vertical" ItemSpacing="2.5"/>
                    </CollectionView.ItemsLayout>
                </CollectionView>
                <Label Text="Завершенные" Style="{StaticResource HeaderLabel}"/>
                <CollectionView ItemsSource="{Binding CompletedTasks}" ItemTemplate="{StaticResource Task}">
                    <CollectionView.ItemsLayout>
                        <LinearItemsLayout Orientation="Vertical" ItemSpacing="2.5"/>
                    </CollectionView.ItemsLayout>
                </CollectionView>
            </VerticalStackLayout>
        </ScrollView>
        <Button Grid.Row="2" Text="Добавить задачу" Style="{StaticResource AddButton}" Clicked="OnAddButtonClicked"/>
    </Grid>
</ContentPage>
